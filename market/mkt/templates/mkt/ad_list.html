{% extends "base_menu.html" %}
{% load static %}
{% block content %}
<h1>Ads</h1>
<p>
{% if ad_list %}
<ul>
  {% for ad in ad_list %}
    <li>
        <a href="{% url 'mkt:detail' ad.id %}">{{ ad.title }}</a>
        {% if ad.owner == user %}
        (<a href="{% url 'mkt:update' ad.id %}">Edit</a> |
        <a href="{% url 'mkt:delete' ad.id %}">Delete</a>)
        {% endif %}
        {% if user.is_authenticated %}
        <dj4e-favstar 
            onclick="favToggle(this, '{% url 'mkt:ad_toggle' ad.id %}');"
            {% if ad.id in favorites %} fav {% endif %} 
        >
        </dj4e-favstar>
        {% endif %}
    </li>
  {% endfor %}
</ul>
{% else %}
  <p>There are no ads in the database.</p>
{% endif %}
</p>
<p>
<a href="{% url 'mkt:create' %}">Create Ad</a> |
{% if user.is_authenticated %}
<a href="{% url 'logout' %}?next={% url 'mkt:all' %}">Logout</a>
{% else %}
<a href="{% url 'login' %}?next={% url 'mkt:all' %}">Login</a>
{% endif %}
</p>
<script>
function favToggle(element, url) {
    console.log('POSTing to', url);
    fetch(url, { method: 'POST', body: '{}' } )
    .then((response) => {
        console.log(url, 'success');
        element.toggleAttribute('fav');
    }).catch((error) => {
        alert('Url failed with '+error+' '+url);
    });
}
</script>
<script type="module" src="{% static 'dj4e-favstar.js' %}"></script>
{% endblock %}
